version: "3.4"
services:
  # Provides a local queue, conforming to AWS Queue (SQS) API
  goaws:
    container_name: alfalfa_goaws
    image: pafortin/goaws
    ports:
      - "4100:4100"
  # Local implementation of s3
  minio:
    container_name: alfalfa_minio
    image: minio/minio:RELEASE.2021-01-16T02-19-44Z
    entrypoint:
      - minio
      - server
      - /data
    ports:
      - "9000:9000"
    environment:
      - MINIO_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - MINIO_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
  mc:
    container_name: alfalfa_mc
    image: minio/mc
    environment:
      - MINIO_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - MINIO_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    entrypoint: >
      /bin/sh -c "
      sleep 5;
      mc config host add myminio http://minio:9000 $${MINIO_ACCESS_KEY} $${MINIO_SECRET_KEY};
      mc mb -p myminio/alfalfa;
      mc policy set public myminio/alfalfa;
      "
    depends_on:
      - minio
  mongo:
    container_name: alfalfa_mongo
    image: mongo:5.0.12
    ports:
      - "27017:27017"
  redis:
    container_name: alfalfa_redis
    image: redis
    ports:
      - "6379:6379"
